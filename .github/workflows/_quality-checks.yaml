name: Quality Checks
permissions:
  contents: read

on:
  workflow_call:

jobs:

  linting:
    name: ğŸ§¹  Linting
    uses: ./.github/workflows/_node_job.yaml
    with:
      run: pnpm lint

  typeCheck:
    name: ğŸ”  Type Check
    uses: ./.github/workflows/_node_job.yaml
    with:
      run: pnpm typecheck

  unitTest:
    name: ğŸ§ª  Unit Test
    uses: ./.github/workflows/_node_job.yaml
    with:
      run: pnpm test
      timeout-minutes: 15

  unusedDependencies:
    name: ğŸ“¦  Unused Dependencies Check
    uses: ./.github/workflows/_node_job.yaml
    with:
      run: pnpx knip --include dependencies

  cdkSynth:
    name: â˜ï¸  CDK Synth
    runs-on: ubuntu-24.04
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v6
      - uses: ./.github/actions/setup-node-pnpm
      - name: Install compatible aws-cdk-lib version
        run: pnpm add -D aws-cdk-lib ts-node constructs cdk-monitoring-constructs cdk-nag
        working-directory: tests/test-project
      - run: pnpx cdk synth --all
        working-directory: tests/test-project

